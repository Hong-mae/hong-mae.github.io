{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/fcm-push-send-structure","result":{"data":{"markdownRemark":{"id":"10b695c4-9d57-587c-8eb9-921fd7c86a0c","html":"<p>fcm 가이드에서는 다음과 같이 쓰라고 되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    'to' <span class=\"token operator\">:</span> 'FireBase Device Token'<span class=\"token punctuation\">,</span>\n    'notification'<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        'title' <span class=\"token operator\">:</span> 'Title'<span class=\"token punctuation\">,</span>\n        'body' <span class=\"token operator\">:</span> 'Body'\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 예제를 그대로 사용할 경우 디바이스 토큰을 가진 사용자 한명에게만 보낸다. 여러명에게 보낼려면 아래의 코드로 테스트 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    'registration_ids' <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>'FireBase Token <span class=\"token number\">1</span>'<span class=\"token punctuation\">,</span> 'FireBase Token <span class=\"token number\">2</span>'<span class=\"token punctuation\">,</span> ...<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    'notification' <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 사용자에게 보이는 제목 및 내용.</span>\n        'title' <span class=\"token operator\">:</span> 'Title'<span class=\"token punctuation\">,</span>\n        'body'  <span class=\"token operator\">:</span> 'Body'\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    ...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>구글링 하고 여러번의 시도 결과 나온 방법이다. 하지만 왜인지 모르게 iOS 앱의 Background에서는 잘되는데 Foreground에서는 안됀다.</p>\n<p>일단 왜 앱을 실행 중일 경우 FCM으로 쏘는 푸시알림이 안보이는지 이해가 안됐다. 하지만 내가 겪는 어려움은 전세계 누구나 한번쯤은 겪는 문제!</p>\n<p>검색을 통해 알아봤다. 의외로 아주 간단했다.</p>\n<p>FCM 데이터를 수신하는 AppDelegate.swift -> UNUserNotificationCenterDelegate 에서 처리한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">AppDelegate</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">UNUserNotificationCenterDelegate</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Receive displayed notifications for iOS 10 devices.</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">userNotificationCenter</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> center<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UNUserNotificationCenter</span><span class=\"token punctuation\">,</span>\n                                willPresent notification<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UNNotification</span><span class=\"token punctuation\">,</span>\n                                withCompletionHandler completionHandler<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span><span class=\"token builtin\">UNNotificationPresentationOptions</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> userInfo <span class=\"token operator\">=</span> notification<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>userInfo\n\n        <span class=\"token comment\">// With swizzling disabled you must let Messaging know about the message, for Analytics</span>\n        <span class=\"token comment\">// Messaging.messaging().appDidReceiveMessage(userInfo)</span>\n        <span class=\"token comment\">// Print message ID.</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> messageID <span class=\"token operator\">=</span> userInfo\\<span class=\"token punctuation\">[</span>gcmMessageIDKey\\<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Message ID: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>messageID<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// completionHandler([])을 아래 부분을 변경하면 된다.</span>\n        <span class=\"token function\">completionHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span>alert<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span>sound<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>completionHandler([])에서 [] 을 [.alert, .sound] 로 변경하면 된다.</p>","fields":{"slug":"/posts/fcm-push-send-structure","tagSlugs":["/tag/mobile/","/tag/push-notification/","/tag/fcm/","/tag/android/","/tag/i-os/","/tag/background/","/tag/foreground/"]},"frontmatter":{"date":"2020-09-02T09:12:01.086Z","description":"안드로이드 및 iOS 앱으로 푸시알림을 보낼 때 RestAPI 활용하기","tags":["Mobile","Push Notification","FCM","Android","iOS","Background","Foreground"],"title":"Android&iOS FCM을 Rest API를 통해 보내기","socialImage":{"publicURL":"/static/f511ec13ae73e78d45d3279f738dcfca/fcm.png"}}}},"pageContext":{"slug":"/posts/fcm-push-send-structure"}},"staticQueryHashes":["1118307107","251939775","401334301"]}