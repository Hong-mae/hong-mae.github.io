{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/ios-swift-Cookie-used","result":{"data":{"markdownRemark":{"id":"037c0b1f-844a-5e5c-ac7c-b02beed13186","html":"<p>WKWebView에서 로그인할때 쿠키로 작동한다면</p>\n<p>쿠키를 가져오는 방법이 여러가지다.</p>\n<p>그 중 지금 필자가 개발하는거에 가장 베스트는 userContentController 를 사용하는 방법이다.</p>\n<p><strong>index.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  ... 생략\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    window<span class=\"token punctuation\">.</span>webkit<span class=\"token punctuation\">.</span>messageHandlers<span class=\"token punctuation\">.</span>핸들러명<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>쿠키<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>ViewController.swift</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">loadView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n    webView<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span>userContentController<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"핸들러명\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n@<span class=\"token function\">available</span><span class=\"token punctuation\">(</span>iOS <span class=\"token number\">8.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">userContentController</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> userContentController<span class=\"token punctuation\">:</span> <span class=\"token builtin\">WKUserContentController</span><span class=\"token punctuation\">,</span> didReceive message<span class=\"token punctuation\">:</span> <span class=\"token builtin\">WKScriptMessage</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string\">\"핸들러명\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 받은 쿠키를 api 에 통신하려고 함</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>웹에서 가져온 쿠키를 그대로 api 서버에 통신하는데 계속 쿠키가 잘못되었다고 에러를 뱉었다.</p>\n<p>해결법을 찾아봤는데 <strong>ViewController->viewDidLoad()</strong>에 다음의 코드를 추가하면 된다.</p>\n<p><strong>ViewController.swift</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n\n    <span class=\"token keyword\">let</span> cookie <span class=\"token operator\">=</span> <span class=\"token builtin\">HTTPCookie</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span>\n    <span class=\"token keyword\">let</span> cookieJar <span class=\"token operator\">=</span> <span class=\"token builtin\">HTTPCookieStorage</span><span class=\"token punctuation\">.</span>shared\n\n    <span class=\"token keyword\">for</span> cookie <span class=\"token keyword\">in</span> cookieJar<span class=\"token punctuation\">.</span>cookies<span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        cookieJar<span class=\"token punctuation\">.</span><span class=\"token function\">deleteCookie</span><span class=\"token punctuation\">(</span>cookie<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이게 뭔지 모르겠지만 쿠키를 다 지워주는거같다. 하지만 웹뷰에서 쿠키를 확인했을때는 쿠키가 삭제되거나 그런일은 없다.</p>","fields":{"slug":"/posts/ios-swift-Cookie-used","tagSlugs":["/tag/i-os/","/tag/application/","/tag/swift/","/tag/web-view/","/tag/wk-web-view/"]},"frontmatter":{"date":"2020-09-04 16:55:34 GMT+0900","description":"iOS의 WKWebview의 쿠키 사용하는 방법 중 하나를 알아보자","tags":["iOS","Application","Swift","WebView","WKWebView"],"title":"iOS/Swift - WKWebView에서 쿠키 사용법 중 하나!","socialImage":{"publicURL":"/static/758536efe3aa40db4af51c32525a44ad/swift_logo.png"}}}},"pageContext":{"slug":"/posts/ios-swift-Cookie-used"}},"staticQueryHashes":["251939775","401334301","825871152"]}